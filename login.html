<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Biodata Download</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Plus Jakarta Sans', sans-serif;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .card-shadow {
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
    }
    
    .input-focus:focus {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }
    
    .btn-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }
    
    .fade-in {
      animation: fadeIn 0.4s ease-in;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .spinner {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 3px solid white;
      width: 24px;
      height: 24px;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full w-full overflow-auto gradient-bg">
  <main class="h-full w-full flex items-center justify-center p-6">
   <div class="w-full max-w-md"><!-- Card Container -->
    <div class="bg-white rounded-2xl card-shadow p-8"><!-- Header -->
     <div class="text-center mb-8">
      <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4">
       <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewbox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
       </svg>
      </div>
      <h1 id="pageTitle" class="text-3xl font-bold text-gray-800 mb-2">Unduh Biodata Anda</h1>
      <p id="pageSubtitle" class="text-gray-600">Masukkan email/nomor telepon dan Password Anda untuk mengakses file</p>
     </div><!-- Form -->
     <form id="verificationForm" class="space-y-6">
      <div><label for="identifier" class="block text-sm font-semibold text-gray-700 mb-2"> Email atau Nomor Telepon </label> <input type="text" id="identifier" name="identifier" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 transition-all input-focus" placeholder="contoh@email.com atau 08123456789" required>
      </div>
      <div><label for="password" class="block text-sm font-semibold text-gray-700 mb-2"> Password </label> <input type="text" id="password" name="password" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 transition-all input-focus" placeholder="Masukkan password Anda" required>
      </div><button type="submit" id="submitBtn" class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-semibold py-3 rounded-lg transition-all btn-hover focus:outline-none focus:ring-4 focus:ring-purple-300"> <span id="btnText">Akses Biodata</span>
       <div id="btnSpinner" class="spinner mx-auto hidden"></div></button>
     </form><!-- Status Message -->
     <div id="statusMessage" class="mt-6 hidden fade-in"></div><!-- Result Card -->
     <div id="resultCard" class="mt-6 hidden fade-in">
      <div class="bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-lg p-6">
       <div class="flex items-start space-x-3 mb-4">
        <svg class="w-6 h-6 text-green-600 mt-1" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <div class="flex-1">
         <h3 id="successTitle" class="font-bold text-green-800 text-lg mb-1">Data Ditemukan!</h3>
         <p class="text-green-700 text-sm mb-4">Klik tombol di bawah untuk mengunduh biodata Anda</p><a id="downloadLink" href="#" target="_blank" rel="noopener noreferrer" class="inline-flex items-center space-x-2 bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-3 rounded-lg transition-all btn-hover">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
          </svg><span>Unduh File</span> </a>
        </div>
       </div>
      </div>
     </div>
    </div><!-- Footer Info -->
    <p class="text-center text-white text-sm mt-6 opacity-90">ðŸ”’ Data Anda aman dan tidak disimpan</p>
   </div>
  </main>
  <script>
    const defaultConfig = {
      page_title: "Unduh Biodata Anda",
      page_subtitle: "Masukkan email/nomor telepon dan password Anda untuk mengakses file",
      button_text: "Akses Biodata",
      success_message: "Data Ditemukan!",
      error_message: "Data tidak ditemukan. Periksa kembali email/nomor telepon dan password Anda."
    };

    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTMoltW5vtVGuSTmdlVKZqGK3gV1aKdWdxIEg69GCaBKI4anahwLLDuSI1RhzuBLUegbMmo3yJEn60b/pub?output=csv';

    let sheetData = [];

    async function onConfigChange(config) {
      const pageTitle = document.getElementById('pageTitle');
      const pageSubtitle = document.getElementById('pageSubtitle');
      const btnText = document.getElementById('btnText');
      const successTitle = document.getElementById('successTitle');

      if (pageTitle) pageTitle.textContent = config.page_title || defaultConfig.page_title;
      if (pageSubtitle) pageSubtitle.textContent = config.page_subtitle || defaultConfig.page_subtitle;
      if (btnText) btnText.textContent = config.button_text || defaultConfig.button_text;
      if (successTitle) successTitle.textContent = config.success_message || defaultConfig.success_message;
    }

    // Load sheet data on page load
    async function loadSheetData() {
      try {
        const response = await fetch(SHEET_URL);
        const csvText = await response.text();
        sheetData = parseCSV(csvText);
      } catch (error) {
        console.error('Error loading sheet data:', error);
      }
    }

    function parseCSV(csv) {
      const lines = csv.split('\n');
      const result = [];
      
      for (let i = 1; i < lines.length; i++) {
        const line = lines[i].trim();
        if (!line) continue;
        
        const values = parseCSVLine(line);
        if (values.length > 0) {
          result.push(values);
        }
      }
      
      return result;
    }

    function parseCSVLine(line) {
      const result = [];
      let current = '';
      let inQuotes = false;
      
      for (let i = 0; i < line.length; i++) {
        const char = line[i];
        
        if (char === '"') {
          inQuotes = !inQuotes;
        } else if (char === ',' && !inQuotes) {
          result.push(current.trim());
          current = '';
        } else {
          current += char;
        }
      }
      
      result.push(current.trim());
      return result;
    }

    function findUserData(identifier, password) {
      const searchTerm = identifier.toLowerCase().trim();
      const searchPassword = password.toLowerCase().trim();
      
      for (let row of sheetData) {
        const email = (row[14] || '').toLowerCase().trim(); // Column O (index 14)
        const phone = (row[15] || '').toLowerCase().trim(); // Column P (index 15)
        const driveLink = row[25] || ''; // Column Z (index 25)
        const rowPassword = (row[21] || '').toLowerCase().trim(); // Column V (index 21)
        
        if ((email === searchTerm || phone === searchTerm) && rowPassword === searchPassword && driveLink) {
          return {
            driveLink: driveLink,
            password: row[21] || '' // Return original case from column V
          };
        }
      }
      
      return null;
    }

    function showMessage(message, isError = false) {
      const statusMessage = document.getElementById('statusMessage');
      statusMessage.className = `mt-6 fade-in p-4 rounded-lg text-sm font-medium ${
        isError 
          ? 'bg-red-50 text-red-800 border-2 border-red-200' 
          : 'bg-blue-50 text-blue-800 border-2 border-blue-200'
      }`;
      statusMessage.textContent = message;
      statusMessage.classList.remove('hidden');
    }

    function hideMessage() {
      const statusMessage = document.getElementById('statusMessage');
      statusMessage.classList.add('hidden');
    }

    function showLoading(show) {
      const submitBtn = document.getElementById('submitBtn');
      const btnText = document.getElementById('btnText');
      const btnSpinner = document.getElementById('btnSpinner');
      
      submitBtn.disabled = show;
      
      if (show) {
        btnText.classList.add('hidden');
        btnSpinner.classList.remove('hidden');
        submitBtn.classList.add('opacity-75', 'cursor-not-allowed');
      } else {
        btnText.classList.remove('hidden');
        btnSpinner.classList.add('hidden');
        submitBtn.classList.remove('opacity-75', 'cursor-not-allowed');
      }
    }

    function showResult(driveLink) {
      const resultCard = document.getElementById('resultCard');
      const downloadLink = document.getElementById('downloadLink');
      
      downloadLink.href = driveLink;
      resultCard.classList.remove('hidden');
    }

    function hideResult() {
      const resultCard = document.getElementById('resultCard');
      resultCard.classList.add('hidden');
    }

    document.getElementById('verificationForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      hideMessage();
      hideResult();
      showLoading(true);
      
      const identifier = document.getElementById('identifier').value;
      const password = document.getElementById('password').value;
      
      // Simulate processing time
      await new Promise(resolve => setTimeout(resolve, 800));
      
      const userData = findUserData(identifier, password);
      
      showLoading(false);
      
      if (userData) {
        const config = window.elementSdk?.config || defaultConfig;
        showResult(userData.driveLink);
      } else {
        const config = window.elementSdk?.config || defaultConfig;
        showMessage(config.error_message || defaultConfig.error_message, true);
      }
    });

    // Load data when page loads
    loadSheetData();

    // Initialize Element SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ["page_title", config.page_title || defaultConfig.page_title],
          ["page_subtitle", config.page_subtitle || defaultConfig.page_subtitle],
          ["button_text", config.button_text || defaultConfig.button_text],
          ["success_message", config.success_message || defaultConfig.success_message],
          ["error_message", config.error_message || defaultConfig.error_message]
        ])
      });
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c1e4d506640fede',t:'MTc2OTA3NzA1MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
