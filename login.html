<!DOCTYPE html>
<html lang="id" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Akses Biodata | ScoutDupta</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Ubuntu&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="https://pradupta.github.io/web/img/logo.png">
   <link rel="shortcut icon" href="https://pradupta.github.io/web/img/logo.png">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            crimson: '#DC143C',
          }
        }
      }
    }
  </script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #111; /* Tema gelap ScoutDupta */
    }
    .logo-text {
      font-family: 'Pacifico', cursive;
    }
    .card-shadow {
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }
    .input-focus:focus {
      border-color: #DC143C;
      box-shadow: 0 0 0 2px rgba(220, 20, 60, 0.2);
    }
    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .spinner {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid #fff;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="h-full flex items-center justify-center p-4">

  <main class="w-full max-w-md fade-in">
    <div class="text-center mb-6">
      <div class="logo-text text-crimson text-4xl mb-2">ScoutDupta</div>
      <div class="h-1 w-20 bg-crimson mx-auto rounded-full"></div>
    </div>

    <div class="bg-white rounded-2xl card-shadow overflow-hidden">
      <div class="bg-gray-900 p-6 text-center">
        <h1 id="pageTitle" class="text-xl font-bold text-white uppercase tracking-wider">Unduh Biodata</h1>
        <p id="pageSubtitle" class="text-gray-400 text-xs mt-1">Gunakan Email/No.HP & Password terdaftar</p>
      </div>

      <div class="p-8">
        <form id="verificationForm" class="space-y-5">
          <div>
            <label class="block text-xs font-bold text-gray-700 uppercase mb-2 tracking-wide">Email / Nomor Telepon</label>
            <div class="relative">
              <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">
                <i class="fas fa-user text-sm"></i>
              </span>
              <input type="text" id="identifier" name="identifier" 
                class="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none input-focus transition-all text-sm" 
                placeholder="Masukkan Identitas" required>
            </div>
          </div>

          <div>
            <label class="block text-xs font-bold text-gray-700 uppercase mb-2 tracking-wide">Password</label>
            <div class="relative">
              <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">
                <i class="fas fa-lock text-sm"></i>
              </span>
              <input type="password" id="password" name="password" 
                class="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none input-focus transition-all text-sm" 
                placeholder="Masukkan Password" required>
            </div>
          </div>

          <button type="submit" id="submitBtn" 
            class="w-full bg-crimson hover:bg-red-700 text-white font-bold py-3 rounded-lg transition-all shadow-lg flex items-center justify-center space-x-2">
            <span id="btnText">AKSES BIODATA</span>
            <div id="btnSpinner" class="spinner hidden"></div>
          </button>
        </form>

        <div id="statusMessage" class="mt-4 hidden p-3 rounded-lg text-xs text-center font-semibold"></div>

        <div id="resultCard" class="mt-6 hidden fade-in border-t pt-6">
          <div class="bg-green-50 border border-green-200 rounded-xl p-4 text-center">
            <div class="text-green-600 text-3xl mb-2">
              <i class="fas fa-check-circle"></i>
            </div>
            <h3 id="successTitle" class="font-bold text-green-800 mb-1">Data Ditemukan!</h3>
            <p class="text-gray-600 text-[10px] mb-4">Silakan unduh file biodata Anda melalui tombol di bawah.</p>
            <a id="downloadLink" href="#" target="_blank" rel="noopener noreferrer" 
               class="inline-flex items-center space-x-2 bg-gray-900 text-white text-xs font-bold px-6 py-3 rounded-full hover:bg-black transition-all">
               <i class="fas fa-download"></i>
               <span>UNDUH SEKARANG</span>
            </a>
          </div>
        </div>
      </div>
    </div>

    <p class="text-center text-gray-500 text-[10px] mt-8 uppercase tracking-[0.2em]">
      <i class="fas fa-shield-alt mr-1 text-crimson"></i> Secure Access System ScoutDupta
    </p>
  </main>

  <script>
    const defaultConfig = {
      page_title: "Unduh Biodata Anda",
      page_subtitle: "Masukkan email/nomor telepon dan password Anda untuk mengakses file",
      button_text: "Akses Biodata",
      success_message: "Data Ditemukan!",
      error_message: "Data tidak ditemukan. Periksa kembali inputan Anda."
    };

    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTMoltW5vtVGuSTmdlVKZqGK3gV1aKdWdxIEg69GCaBKI4anahwLLDuSI1RhzuBLUegbMmo3yJEn60b/pub?output=csv';

    let sheetData = [];

    async function loadSheetData() {
      try {
        const response = await fetch(SHEET_URL);
        const csvText = await response.text();
        sheetData = parseCSV(csvText);
      } catch (error) {
        console.error('Error loading data:', error);
      }
    }

    function parseCSV(csv) {
      const lines = csv.split('\n');
      return lines.slice(1).map(line => parseCSVLine(line.trim())).filter(row => row.length > 0);
    }

    function parseCSVLine(line) {
      const result = [];
      let current = '', inQuotes = false;
      for (let i = 0; i < line.length; i++) {
        if (line[i] === '"') inQuotes = !inQuotes;
        else if (line[i] === ',' && !inQuotes) { result.push(current.trim()); current = ''; }
        else current += line[i];
      }
      result.push(current.trim());
      return result;
    }

    function findUserData(identifier, password) {
      const term = identifier.toLowerCase().trim();
      const pass = password.trim();
      for (let row of sheetData) {
        const email = (row[14] || '').toLowerCase().trim();
        const phone = (row[15] || '').toLowerCase().trim();
        const rowPass = (row[21] || '').trim();
        const link = row[25] || '';
        if ((email === term || phone === term) && rowPass === pass && link) {
          return { driveLink: link };
        }
      }
      return null;
    }

    document.getElementById('verificationForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const statusMsg = document.getElementById('statusMessage');
      const resCard = document.getElementById('resultCard');
      const btnText = document.getElementById('btnText');
      const spinner = document.getElementById('btnSpinner');
      const submitBtn = document.getElementById('submitBtn');

      statusMsg.classList.add('hidden');
      resCard.classList.add('hidden');
      
      // Loading state
      btnText.classList.add('hidden');
      spinner.classList.remove('hidden');
      submitBtn.disabled = true;

      const iden = document.getElementById('identifier').value;
      const pass = document.getElementById('password').value;

      await new Promise(r => setTimeout(r, 1200));
      const user = findUserData(iden, pass);

      btnText.classList.remove('hidden');
      spinner.classList.add('hidden');
      submitBtn.disabled = false;

      if (user) {
        document.getElementById('downloadLink').href = user.driveLink;
        resCard.classList.remove('hidden');
      } else {
        statusMsg.textContent = defaultConfig.error_message;
        statusMsg.className = "mt-4 p-3 rounded-lg text-xs text-center font-semibold bg-red-50 text-red-600 border border-red-100";
        statusMsg.classList.remove('hidden');
      }
    });

    loadSheetData();
    setInterval(loadSheetData, 30000);
  </script>
</body>
</html>
